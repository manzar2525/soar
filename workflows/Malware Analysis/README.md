# Detailed Malware Analysis Playbook - Granular Steps

## 1. Sample Receipt and Preparation

### Sample Documentation
1. Generate unique case/sample ID
2. Record source of the sample
3. Document submission context/incident details
4. Record date/time received
5. Document priority level
6. Record analyst assigned
7. Create secure storage location for sample

### Initial Sample Processing
1. Calculate file hashes (MD5, SHA1, SHA256)
2. Record file size
3. Document file name and extension
4. Check file type (PE, ELF, DOC, PDF, etc.)
5. Verify file integrity
6. Check if file is packed/obfuscated
7. Record initial observations

### Analysis Environment Preparation
1. Prepare isolated analysis network
2. Prepare clean virtual machine snapshots
3. Configure monitoring and capturing tools
4. Set up network traffic capture
5. Prepare memory capture tools
6. Configure sandbox environment
7. Verify isolation measures

## 2. Static Analysis

### File Identification and Classification
1. Identify file format (using file command, TrID, etc.)
2. Verify magic bytes
3. Check header structure
4. Validate against expected file format
5. Identify anomalies in file structure
6. Detect file type mismatches
7. Document file metadata (creation date, author, etc.)

### Hash-based Analysis
1. Query file hashes against internal database
2. Check hashes against VirusTotal
3. Query MISP/threat intelligence platforms
4. Check against YARA rules
5. Compare with known malware families
6. Identify previously analyzed similar samples
7. Document all hash-based findings

### Code Analysis
1. Identify programming language/compiler
2. Analyze PE/ELF headers
3. Check import/export tables
4. Identify linked libraries
5. Analyze section headers and permissions
6. Check for abnormal section attributes
7. Identify entry points and code regions

### String Extraction and Analysis
1. Extract ASCII strings
2. Extract Unicode strings
3. Extract obfuscated/encoded strings
4. Identify command lines and parameters
5. Extract potential C2 URLs/IPs
6. Identify file paths and registry keys
7. Look for encryption keys and passwords
8. Document all significant strings

### Binary/Code Disassembly
1. Load sample in disassembler (IDA Pro, Ghidra, etc.)
2. Analyze program flow
3. Identify key functions
4. Analyze API calls
5. Locate obfuscated code sections
6. Identify anti-analysis techniques
7. Document key functionality discovered

### Resource and Component Analysis
1. Extract embedded resources
2. Analyze embedded files
3. Check for shellcode
4. Identify encrypted/compressed sections
5. Extract and analyze embedded scripts
6. Check for digital signatures
7. Verify certificate validity if signed

## 3. Dynamic Analysis

### Pre-execution Preparation
1. Configure system monitoring tools
2. Set up network capture (Wireshark, tcpdump)
3. Prepare API call monitoring
4. Configure file system monitoring
5. Set up registry monitoring
6. Prepare memory analysis tools
7. Take system snapshot
8. Document baseline system state

### Controlled Execution
1. Execute sample in isolated environment
2. Monitor initial execution behavior
3. Document initial process creation
4. Observe for immediate indicators
5. Check for crashes or errors
6. Monitor for spawned processes
7. Record execution flow

### Process Activity Analysis
1. Monitor process creation/termination
2. Track process relationships (parent/child)
3. Analyze process privileges
4. Monitor for injected code
5. Check for hollowed processes
6. Analyze memory regions
7. Monitor for unusual process behavior

### File System Analysis
1. Monitor file creation
2. Track file modifications
3. Document file deletions
4. Check for dropped files
5. Identify temporary files
6. Detect file attribute changes
7. Record all file system changes

### Registry Analysis
1. Monitor registry key creation
2. Track registry value modifications
3. Check for autorun entries
4. Identify persistence mechanisms
5. Monitor for hijacked registry keys
6. Check for defense evasion techniques
7. Document all registry activities

### Network Analysis
1. Monitor DNS queries
2. Track HTTP/HTTPS connections
3. Analyze TCP/UDP communications
4. Identify connection patterns
5. Capture full packet data
6. Analyze C2 protocol behavior
7. Identify data exfiltration attempts
8. Document all network indicators

### Memory Analysis
1. Capture memory during execution
2. Analyze memory for injected code
3. Extract strings from memory
4. Identify hidden modules
5. Extract encryption keys from memory
6. Locate credentials in memory
7. Document memory-based indicators

## 4. Advanced Analysis

### Code Reverse Engineering
1. Identify key algorithms
2. Decompile to pseudocode when possible
3. Document program logic
4. Reconstruct control flow
5. Identify obfuscated functions
6. Reverse engineer custom protocols
7. Document complete program behavior

### Debugging Analysis
1. Set breakpoints at key functions
2. Step through critical code sections
3. Observe register and memory changes
4. Analyze parameter passing
5. Identify decision logic
6. Trace execution path
7. Document debugging findings

### Decryption and Deobfuscation
1. Identify encryption algorithms
2. Extract encryption keys
3. Decrypt obfuscated strings
4. Decode encoded commands
5. Unpack packed executables
6. Decrypt network communications
7. Document all decrypted content

### Anti-Analysis Detection
1. Identify anti-VM techniques
2. Document anti-debugging methods
3. Detect sandbox evasion techniques
4. Identify timing-based evasions
5. Document environment checks
6. Identify geofencing restrictions
7. Bypass identified anti-analysis features

## 5. Capability Assessment

### Malware Classification
1. Determine malware type (RAT, ransomware, etc.)
2. Identify malware family
3. Compare with known variants
4. Determine malware generation
5. Identify custom/known malware framework
6. Assess sophistication level
7. Document complete classification

### Functionality Assessment
1. Document persistence mechanisms
2. Identify privilege escalation methods
3. Determine lateral movement capabilities
4. Document defense evasion techniques
5. Assess data collection capabilities
6. Identify command and control methods
7. Document exfiltration techniques
8. Map to MITRE ATT&CK framework

### Attribution Analysis
1. Analyze code style/patterns
2. Check for language artifacts
3. Identify TTPs matching known actors
4. Check compilation timestamps
5. Look for cultural indicators
6. Compare with attribution reports
7. Document potential attribution

## 6. Indicator Extraction

### IOC Compilation
1. Extract all file hashes
2. Document all associated files
3. Record all network indicators (IPs, URLs, domains)
4. Document registry indicators
5. Extract file paths and names
6. Document mutex/pipe names
7. Record scheduled tasks/services
8. Extract any credentials or keys

### Detection Rule Development
1. Create YARA signatures
2. Develop Snort/Suricata rules
3. Create SIEM detection rules
4. Develop EDR detection queries
5. Create Sigma rules
6. Develop behavioral detection rules
7. Test rule effectiveness
8. Document all detection rules

## 7. Reporting and Intelligence

### Technical Report Creation
1. Document sample details
2. Record analysis methodology
3. Document static analysis findings
4. Record dynamic analysis results
5. Document advanced analysis insights
6. List all identified capabilities
7. Include complete IOC listing
8. Document detection methods
9. Create executive summary

### Intelligence Integration
1. Update internal threat database
2. Share IOCs with security systems
3. Update detection rules
4. Share analysis with trusted partners
5. Submit to information sharing platforms
6. Update malware family profiles
7. Document lessons learned

## 8. Remediation Planning

### Remediation Guidance
1. Develop containment procedures
2. Create removal instructions
3. Document required system repairs
4. Develop recovery procedures
5. Create verification steps
6. Document prevention measures
7. Prepare remediation checklist